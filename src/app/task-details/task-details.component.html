<!-- task-details.component.html -->
<div class="task-detail-container">
  <div class="task-detail-header">
    <button class="back-btn" (click)="goBack()">‚Üê Back to Dashboard</button>
    <h1 class="page-title">Task Details</h1>
  </div>

  <div *ngIf="task; else noTaskData" class="task-detail-card">
  
    <form [formGroup]="editForm" (ngSubmit)="updateTask()">
      <div class="task-detail-header-info">
        <!-- Title Section -->
        <div class="title-section">
          <h3 class="section-title">Title</h3>
          <div *ngIf="!editMode" class="display-value">
            <h2 class="task-title">{{ task.title }}</h2>
          </div>
          <div *ngIf="editMode" class="edit-field">
            <input 
              type="text" 
              formControlName="title" 
              class="form-input"
              [class.error]="title?.invalid && title?.touched"
              placeholder="Enter task title"
            >
            <div *ngIf="title?.invalid && title?.touched" class="error-message">
              <span *ngIf="title?.errors?.['required']">Task title is required</span>
              <span *ngIf="title?.errors?.['minlength']">Title must be at least 3 characters</span>
            </div>
          </div>
        </div>

       
        <div class="status-section">
          <h3 class="section-title">Status</h3>
          <div *ngIf="!editMode">
            <span class="task-badge" [ngClass]="task.status.toString()">
              {{ task.status }}
            </span>
          </div>
          <div *ngIf="editMode" class="edit-field">
            <select 
              formControlName="status" 
              class="form-select"
              [class.error]="status?.invalid && status?.touched"
            >
              <option value="">Select status</option>
              <option value="TODO">To Do</option>
              <option value="IN_PROGRESS">In Progress</option>
              <option value="COMPLETED">Completed</option>
            </select>
            <div *ngIf="status?.invalid && status?.touched" class="error-message">
              <span *ngIf="status?.errors?.['required']">Status is required</span>
            </div>
          </div>
        </div>
      </div>

      <div class="task-detail-content">
       
        <div class="detail-section">
          <h3 class="section-title">Description</h3>
          <div *ngIf="!editMode">
            <p class="task-description">{{ task.description }}</p>
          </div>
          <div *ngIf="editMode" class="edit-field">
            <textarea 
              formControlName="description" 
              class="form-textarea"
              [class.error]="description?.invalid && description?.touched"
              rows="4"
              placeholder="Enter task description"
            ></textarea>
            <div *ngIf="description?.invalid && description?.touched" class="error-message">
              <span *ngIf="description?.errors?.['minlength']">Description must be at least 9 characters</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3 class="section-title">Due Date</h3>
          <div *ngIf="!editMode">
            <p class="task-due-date">{{ task.dueDate | date:'fullDate' }}</p>
          </div>
          <div *ngIf="editMode" class="edit-field">
            <input 
              type="date" 
              formControlName="dueDate" 
              class="form-input"
              [class.error]="dueDate?.invalid && dueDate?.touched"
            >
            <div *ngIf="dueDate?.invalid && dueDate?.touched" class="error-message">
              <span *ngIf="dueDate?.errors?.['required']">Due date is required</span>
            </div>
          </div>
        </div>


      </div>
  <div *ngIf="deleteDialog" class="dialog-overlay">
<div class="dialog-box">
   <p>Do you really want to delete this task?</p>
    <div class="dialog-actions">
      <button class="btn btn-red" (click)="deleteTask()">Yes, Delete</button>
      <button class="btn btn-secondary" (click)="closeDialog()">Cancel</button>
    </div>
  </div>  
</div>
  
      <div class="task-actions">
        <div *ngIf="!editMode" class="view-actions">
          <button type="button" class="btn btn-primary" (click)="setEditMode()">Edit Task</button>
          <button type="button" class="btn btn-red" (click)="openDialog()"  >Delete Task</button>
        </div>
        
        <div *ngIf="editMode" class="edit-actions">
          <button 
            type="submit" 
            class="btn btn-primary"
          >
          EDIT
          </button>
        
        </div>
      </div>
    </form>
  </div>

  <ng-template #noTaskData>
    <div >
      <h2>No task data available</h2>
      <p>The task information could not be loaded.</p>
      <button class="btn btn-primary" (click)="goBack()">Return to Dashboard</button>
    </div>
  </ng-template>
</div>